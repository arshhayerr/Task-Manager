if (task.isEditing) {
  // Save Button
  const saveButton = document.createElement('button');
  saveButton.innerHTML = '<i class="fas fa-save"></i>';
  saveButton.className = 'px-2 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded';
  saveButton.title = 'Save Changes';
  saveButton.onclick = (e) => { e.stopPropagation(); saveTaskEdit(task.id); };
  buttonsDiv.appendChild(saveButton);

  // Cancel Button
  const cancelButton = document.createElement('button');
  cancelButton.innerHTML = '<i class="fas fa-times"></i>';
  cancelButton.className = 'px-2 py-1 text-xs bg-gray-400 hover:bg-gray-500 text-white rounded';
  cancelButton.title = 'Cancel Edit';
  cancelButton.onclick = (e) => { e.stopPropagation(); cancelTaskEdit(task.id); };
  buttonsDiv.appendChild(cancelButton);

} else {
  // Complete/Undo Button
  const completeButton = document.createElement('button');
  completeButton.innerHTML = task.completed ? '<i class="fas fa-undo"></i>' : '<i class="fas fa-check"></i>';
  completeButton.className = px-2 py-1 text-xs rounded ${task.completed ? 'bg-yellow-400 hover:bg-yellow-500 text-black dark:text-white' : 'bg-green-500 hover:bg-green-600 text-white'};
  completeButton.title = task.completed ? 'Mark as Incomplete' : 'Mark as Complete';
  completeButton.onclick = (e) => { e.stopPropagation(); toggleTaskComplete(task.id); };
  buttonsDiv.appendChild(completeButton);

  // Edit Button (only if not completed)
  if (!task.completed) {
      const editButton = document.createElement('button');
      editButton.innerHTML = '<i class="fas fa-pencil-alt"></i>';
      editButton.className = 'px-2 py-1 text-xs bg-blue-400 hover:bg-blue-500 text-white rounded';
      editButton.title = 'Edit Task';
      editButton.onclick = (e) => { e.stopPropagation(); editTask(task.id); };
      buttonsDiv.appendChild(editButton);
  }

  // Delete Button
  const deleteButton = document.createElement('button');
  deleteButton.innerHTML = '<i class="fas fa-trash"></i>';
  deleteButton.className = 'px-2 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded';
  deleteButton.title = 'Delete Task';
  deleteButton.onclick = (e) => {
      e.stopPropagation();
      if (confirm(Are you sure you want to delete task: "${task.description}"?)) {
           deleteTask(task.id);
      }
  };
  buttonsDiv.appendChild(deleteButton);
}

li.appendChild(buttonsDiv);
taskList.appendChild(li);
});
updateWeeklyReview(); // Update review whenever tasks change
}

